# SSH Аутентификация в YaroAdminUI

Как войти используя SSH ключ, который уже есть на сервере.

## Пошаговая инструкция

### 1. Откройте веб-интерфейс

Откройте http://localhost:666 (или http://144.124.237.222:666 для удаленного сервера)

### 2. Перейдите на вкладку "SSH Ключ"

На главном экране выберите вкладку "SSH Ключ" (первая вкладка)

### 3. Сгенерируйте сообщение для подписи

Нажмите кнопку "Сгенерировать" - это создаст уникальное сообщение вида:

```
YaroAdminUI-Auth-abc123def456...
```

### 4. Подпишите сообщение своим SSH ключом

Сообщение появится в текстовом поле. Теперь нужно подписать его вашим приватным ключом.

**На Linux/macOS:**

```bash
# Скопируйте содержимое поля "SSH Сообщение для подписи" в файл
echo "YaroAdminUI-Auth-abc123def456..." > /tmp/message.txt

# Подпишите сообщение вашим приватным SSH ключом
ssh-keygen -Y sign -f ~/.ssh/id_rsa -n YaroAdminUI-Auth < /tmp/message.txt

# Это создаст файл /tmp/message.txt.sig
# Прочитайте подпись в base64 формате
cat /tmp/message.txt.sig | base64
```

**На Windows (с Git Bash или OpenSSH):**

```bash
# Скопируйте сообщение в файл
echo "YaroAdminUI-Auth-abc123def456..." > C:\temp\message.txt

# Подпишите сообщение
ssh-keygen -Y sign -f C:\Users\YourUsername\.ssh\id_rsa -n YaroAdminUI-Auth < C:\temp\message.txt

# Прочитайте подпись
certutil -encode C:\temp\message.txt.sig C:\temp\message.sig.b64
type C:\temp\message.sig.b64
```

### 5. Вставьте подпись в форму

Скопируйте **всю** подпись (всё содержимое файла `.sig`) и вставьте в поле "Подпись (base64)"

### 6. Нажмите "Вход через SSH"

Если всё правильно, вы войдете в dashboard и сможете управлять сервером!

## Важные детали

### Формат подписи

Подпись должна быть в base64 формате. Если вы получаете файл `.sig`, содержащий:

```
-----BEGIN SSH SIGNATURE-----
ABC123DEF456...
-----END SSH SIGNATURE-----
```

Вставьте ВСЁ это содержимое целиком в поле подписи.

### Какой SSH ключ использовать?

- Используйте приватный ключ (~/.ssh/id_rsa или ~/.ssh/id_ed25519)
- На сервере должен быть соответствующий публичный ключ (~/.ssh/id_rsa.pub)
- Для каждого входа нужно подписывать **разные** сообщения (они разные каждый раз)

### Требования OpenSSH

Функция подписи SSH требует **OpenSSH версии 8.2 или выше**.

Проверьте версию:

```bash
ssh -V
```

Если версия ниже 8.2, обновите OpenSSH.

## Примеры команд

### Полный процесс (Linux/macOS)

```bash
# 1. Скопируйте сообщение из веб-интерфейса и сохраните в файл
echo "YaroAdminUI-Auth-xxxxxxxxxxxx" > ~/message.txt

# 2. Подпишите сообщение
ssh-keygen -Y sign -f ~/.ssh/id_rsa -n YaroAdminUI-Auth < ~/message.txt

# 3. Прочитайте подпись (вывод будет содержать -----BEGIN SSH SIGNATURE-----)
cat ~/message.txt.sig

# 4. Скопируйте всё содержимое и вставьте в веб-форму
```

### Альтернативно - использование stdout

```bash
# Всё в одной команде с выводом на экран
echo "YaroAdminUI-Auth-xxxxxxxxxxxx" | ssh-keygen -Y sign -f ~/.ssh/id_rsa -n YaroAdminUI-Auth | cat
```

## Решение проблем

### Ошибка: "SSH подпись невалидна"

Возможные причины:

1. ❌ Используется неправильный приватный ключ
2. ❌ На сервере нет соответствующего публичного ключа
3. ❌ Сообщение было изменено перед подписанием (скопировано с ошибкой)
4. ❌ Подпись повреждена или не в base64 формате

**Решение:**

- Убедитесь что используете правильный ключ (-f ~/.ssh/id_rsa)
- Проверьте что на сервере есть ~/.ssh/id_rsa.pub
- Пересоздайте сообщение кнопкой "Сгенерировать"
- Скопируйте подпись полностью включая -----BEGIN и -----END

### Ошибка: "ssh-keygen: command not found"

OpenSSH не установлен. Установите его:

- **Linux (Ubuntu/Debian):** `sudo apt-get install openssh-client`
- **macOS:** OpenSSH уже установлен
- **Windows:** Установите Git Bash или Windows Subsystem for Linux (WSL)

## Дополнительно

Для более безопасного входа рекомендуется:

1. Использовать сильные SSH ключи (ed25519)
2. Не делиться приватными ключами
3. Регулярно ротировать ключи
4. Использовать passphrase для приватного ключа
